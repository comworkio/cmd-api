stages:
  - mirror
  - publish

github-mirror:
  stage: mirror
  script:
    - setsid ./ci/github-mirror.sh
  only:
    - /^(master.*)$/
  tags:
    - cmd-api

cmd-api:
  stage: publish
  script:
    - setsid ./ci/docker-deliver.sh "cmd-api" "2.2"
  only:
    refs:
      - /^(master.*)$/
    changes:
      - api.py
      - Dockerfile
      - docker-compose-build.yml
  tags:
    - cmd-api
